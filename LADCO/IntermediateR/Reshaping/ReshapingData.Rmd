---
title: "Reshaping Data"
output: html_document
---

# Reshaping with gather(){#gather}

Often we have data in a format that is not convenient for a certain purpose. For instance,
we may look at the `chicago_air` data set

```{r}
head(chicago_air)
```

and wish that we could have one column with all the values and one column with all of the parameter names. The current format would be called wide, because it has the parameters
spread out as columns. Since we want to gather those column names into one column, we use
the `gather()` function in the `tidyr` package.

```{r, message=FALSE, warning=FALSE}
library(tidyr)
d <- gather(chicago_air, key = parameter, value = daily_value, ozone:solar)
head(d, 3)
unique(d$parameter)
```

The first paramter of the `gather()` function is the data frame, the second parameter
is the name that you want the factor to have (in our case, we're calling it `parameter`), 
the third parameter is the name of the column where you will be placing the original
values (we specified that these are daily values for each record), 
and the fourth parameter specifies which columns will be gathered.

One reason to reshape data in this way is to make it easier to feed into a plotting
function such as `ggplot()`.

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
d$date <- as.Date(d$date)
p <- ggplot(d, aes(date, daily_value)) 
p + geom_point() + facet_grid(parameter ~., scales = "free")
```

# Reshape with spread(){#spread}

We may also wish that we could reshape data that is long into a wide format. The `airdata` dataset 
in the `region5air` package is in a long format.

```{r}
data(airdata)
airdata$parameter <- factor(airdata$parameter, levels = c(44201, 88101, 62101),
                            labels = c("ozone", "pm2.5", "temp"))
sites <- unique(airdata$site)
airdata$site <- factor(airdata$site, sites, labels = LETTERS[1:length(sites)])
head(select(airdata, site, datetime, poc, parameter, value), 3)
unique(airdata$parameter)
```

It might be more convenient to have this dataset in the format that `chicago_air` is in. To spread out
the parameter column, we use the `spread()` function from the `tidyr` package.

```{r}
# clean up airdata--take the mean of multiple POCs
airdata_wide <- group_by(airdata, site, datetime, parameter)
airdata_wide <- summarise(airdata_wide, value = mean(value))

airdata_wide <- spread(airdata_wide, key = parameter, value = value)
head(airdata_wide, 3)
```

This gives a value for each site/datetime. If we wanted a separate column for
each pollutant/site, we could create a pollutant/site column.

```{r}
airdata_wide <- transmute(airdata, parameter_site = paste(parameter, site, sep = "_"),
                     datetime, value)
airdata_wide <- spread(airdata_wide, key = parameter_site, value = value)
head(select(airdata_wide, datetime, ozone_A:ozone_E), 3)
names(airdata_wide)
```